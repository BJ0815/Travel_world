<section>
  <div class="container">
    <div class="row">
      <div class="card mb-3">
        <img class="card-img-top" src="http://via.placeholder.com/1161x360" alt="Card image cap">
        <div class="card-body">
          <h3 class="card-title"><%= @event.title %></h3>
          <div class="star-rating" data-score= <%= @arg_num %> ></div>
          <em><%= "#{@replies.length}則評論" %></em>
          <% if @event.favorited?(current_user) %>
            <%= link_to "取消收藏", unfavorite_event_path(@event), method: :post, class: "btn btn-default" %>
          <% else %>
            <%= link_to "收藏", favorite_event_path(@event), method: :post, class: "btn btn-primary" %>
          <% end %>
          <%= link_to "複製", clone_event_path(@event), method: :post, class: "btn btn-primary" %>
          <p class="card-text"><%= @event.info %></p>
          <p class="card-text"><small class="text-muted"><%= time_tag @event.created_at %></small></p>
          <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <a class="nav-item nav-link active" id="nav-detail-tab" data-toggle="tab" href="#nav-detail" role="tab" aria-controls="nav-detail" aria-selected="true">Detail</a>
              <a class="nav-item nav-link" id="nav-reply-tab" data-toggle="tab" href="#nav-reply" role="tab" aria-controls="nav-reply" aria-selected="false">reply</a>
              <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Contact</a>
            </div>
          </nav>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-detail" role="tabpanel" aria-labelledby="nav-detail-tab">
              <div class="d-flex flex-column text-center mt-3">
                <% @schedules.each do |schedule| %>
                <div class="m-3">
                  <h3>第<%= schedule.day %>天</h3>
                  <p>住宿：<%= schedule.stay %></p>
                  <h4>Details</h4>
                  <div class="card-deck">
                    <% schedule.details.each do |detail| %>
                      <div class="card">
                        <div class="card-body">
                          <h5>在<%= detail.spot.spot_name %></h5>
                          <p class="card-text">停留時間：<%= detail.hr %> hr</p> 
                          <p class="card-text"><%= detail.content %></p>
                        </div>
                      </div>
                    <% end %>
                  </div>
                </div>
                <hr>
                <% end %>
              </div>
            </div>
            <div class="tab-pane fade" id="nav-reply" role="tabpanel" aria-labelledby="nav-reply-tab">
              <div class="m-5">
                <% @replies.each do |reply| %>
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title d-inline"><%= reply.user.name %></h4>
                      <div class="star-rating" data-score= <%= reply.number %> ></div>
                      <p class="d-inline"><small class="text-muted"><%= time_tag reply.created_at %></small></p>
                      <p class="card-text p-5 m-3 bg-light"><%= reply.comment %></p>
                    </div>
                  </div>
                <% end %>
              </div>
              <br />

              <div>
                <h3>Reply</h3>
                <%= form_for [@event, @reply] do |t| %>
                <div class="form-group">
                  <div id="star-rating"></div>
                </div>
                <div class="form-group">
                  <%= t.text_area :comment, placeholder: "What's are you mind?", class: "form-control", rows: "3" %>
                </div>
                <div class="form-group">
                  <%= t.submit "Submit", class: "btn btn-primary" %>
                </div>
                <% end %>
              </div>
            </div>
            <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $('.star-rating').raty({
    path: '/assets/',
    readOnly: true,
    score: function(){
      return $(this).attr('data-score');
    }
  });

  $('#star-rating').raty({
    path: '/assets/',
    scoreName: 'reply[number]'
  });
</script>
